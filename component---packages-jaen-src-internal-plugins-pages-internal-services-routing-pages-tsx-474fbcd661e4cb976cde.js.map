{"version":3,"file":"component---packages-jaen-src-internal-plugins-pages-internal-services-routing-pages-tsx-474fbcd661e4cb976cde.js","mappings":"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","sources":["webpack://demo/../../node_modules/hash-source/src/dist/createHashSource.js","webpack://demo/../../packages/jaen/src/internal-plugins/pages/internal/services/routing/pages/dynamic.tsx","webpack://demo/../../packages/jaen/src/utils/hooks/usePromiseEffect.tsx","webpack://demo/../../packages/jaen/src/internal-plugins/pages/internal/services/routing/pages/_.tsx"],"sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar getHashPath = function getHashPath() {\n  var href = window.location.href;\n  var hashIndex = href.indexOf('#');\n  return hashIndex === -1 ? '' : href.substring(hashIndex + 1);\n};\n\nvar pushHashPath = function pushHashPath(path) {\n  return window.location.hash = path;\n};\n\nvar replaceHashPath = function replaceHashPath(path) {\n  var hashIndex = window.location.href.indexOf('#');\n  window.location.replace(window.location.href.slice(0, hashIndex >= 0 ? hashIndex : 0) + '#' + path);\n};\n\nvar getState = function getState(path) {\n  var pathname = path ? path : getHashPath();\n  return {\n    pathname: pathname,\n    search: ''\n  };\n};\n\nvar resolveInitialState = function resolveInitialState(state) {\n  if (state.pathname === '') {\n    replaceHashPath('/');\n  }\n};\n\nvar createHashSource = function createHashSource() {\n  var state = getState();\n  resolveInitialState(state);\n  return {\n    get location() {\n      return getState();\n    },\n\n    addEventListener: function addEventListener(name, fn) {\n      window.addEventListener(name, fn);\n    },\n    removeEventListener: function removeEventListener(name, fn) {\n      window.removeEventListener(name, fn);\n    },\n    history: {\n      state: state,\n      pushState: function pushState(stateObj, _, uri) {\n        state = getState(uri);\n        pushHashPath(uri);\n      },\n      replaceState: function replaceState(stateObj, _, uri) {\n        state = getState(uri);\n        replaceHashPath(uri);\n      }\n    }\n  };\n};\n\nexports.default = createHashSource;","import {Center, CircularProgress} from '@chakra-ui/react'\nimport {useAppSelector, withRedux} from '@jaen-pages/internal/redux'\nimport {\n  useJaenTemplates,\n  useSiteContext\n} from '@jaen-pages/internal/services/site'\nimport {usePromiseEffect} from '@jaen/utils/hooks/usePromiseEffect'\nimport {RouteComponentProps} from '@reach/router'\nimport {navigate, PageProps} from 'gatsby'\nimport * as React from 'react'\n\nconst Dynamic = (props: RouteComponentProps & Partial<PageProps>) => {\n  const dynamicPaths = useAppSelector(\n    state => state.internal.routing.dynamicPaths\n  )\n\n  const path = props.location?.hash?.substring(1)\n\n  if (typeof window === 'undefined') {\n    return <>dynamic</>\n  }\n\n  if (!path) {\n    throw new Error('Something went wrong while preparing a dynamic page')\n  }\n\n  const {pageId, templateName} = React.useMemo(() => dynamicPaths[path], [path])\n\n  const {templateLoader} = useSiteContext()\n\n  React.useEffect(() => {\n    // We can determine if a page has been moved by checking if the path is no longer in the dynamicPaths, if so\n    // we search for the the new path in the dynamicPaths by pageId and redirect to it.\n\n    if (!(path in dynamicPaths)) {\n      const newPath = Object.keys(dynamicPaths).find(\n        path => dynamicPaths[path]?.pageId === pageId\n      )\n\n      if (newPath) {\n        // Page has been moved, update to the new path\n        navigate(`/_#${newPath}`)\n      } else {\n        // Page has been deleted, redirect to the parent page\n        navigate('/')\n      }\n    }\n  }, [dynamicPaths])\n\n  const loadingComponent = (\n    <Center>\n      <CircularProgress isIndeterminate color=\"green.300\" />\n    </Center>\n  )\n\n  const templates = useJaenTemplates()\n\n  // We need to wait for the template to be loaded before we can render the page,\n  // so template null means the template is not loaded yet\n  const template = templates\n    ? templates.find(t => t.name === templateName)\n    : null\n\n  if (template === undefined) {\n    // Templates are loaded, but the template is not found\n    throw new Error(\n      `Could not find template ${templateName} for dynamic page ${pageId}.`\n    )\n  }\n\n  const {value: Component} = usePromiseEffect(async () => {\n    if (template) {\n      // TODO: Remove this hack to ignore incorrect template names\n      return await templateLoader(templateName)\n    }\n  }, [template])\n\n  if (!Component) {\n    return loadingComponent\n  }\n\n  return (\n    <Component\n      {...(props as any)}\n      pageContext={{...props.pageContext, jaenPageId: pageId}}\n      data={{...props.data, jaenPage: null}}\n    />\n  )\n}\n\nexport default withRedux(Dynamic)\n","import * as React from 'react'\nimport {DependencyList} from 'react'\n\ntype PromiseState<T> =\n  | {status: 'idle' | 'pending'; value: null; error: null}\n  | {status: 'fulfilled'; value: T; error: null}\n  | {status: 'rejected'; value: null; error: Error}\n\nexport function usePromiseEffect<T>(\n  effect: () => Promise<T>,\n  deps: DependencyList\n) {\n  const [state, setState] = React.useState<PromiseState<T>>({\n    status: 'idle',\n    value: null,\n    error: null\n  })\n\n  React.useEffect(() => {\n    effect()\n      .then(value => setState({status: 'fulfilled', value, error: null}))\n      .catch(error => setState({status: 'rejected', value: null, error}))\n  }, deps)\n\n  // chose the shape you prefer for the return type,\n  // here are some examples:\n  // return [state.value, state.status === 'pending', state.error]\n  // return [state.value, state.status, state.error]\n\n  return state\n}\n","import {createHistory, HistorySource, Router} from '@reach/router'\nimport createHashSource from 'hash-source'\nimport Dynamic from './dynamic'\n\nconst _ = () => {\n  if (typeof window !== 'undefined') {\n    const source = createHashSource()\n    const history = createHistory(source as HistorySource)\n\n    return (\n      <Router primary={false}>\n        <Dynamic path=\"/_\" />\n      </Router>\n    )\n  }\n\n  return null\n}\n\nexport default _\n"],"names":["replaceHashPath","path","hashIndex","window","location","href","indexOf","replace","slice","getState","pathname","substring","search","exports","state","resolveInitialState","addEventListener","name","fn","removeEventListener","history","pushState","stateObj","_","uri","hash","replaceState","withRedux","props","dynamicPaths","useAppSelector","internal","routing","Error","React","pageId","templateName","templateLoader","useSiteContext","newPath","Object","keys","find","navigate","loadingComponent","Center","isIndeterminate","color","templates","useJaenTemplates","template","t","undefined","effect","deps","setState","Component","status","value","error","then","catch","pageContext","jaenPageId","data","jaenPage","source","createHashSource","createHistory","Router","primary"],"sourceRoot":""}